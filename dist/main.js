/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={1016:(t,e,r)=>{r.d(e,{A:()=>qt});var n=r(1601),o=r.n(n),a=r(6314),i=r.n(a),c=r(4417),l=r.n(c),s=new URL(r(7935),r.b),u=new URL(r(1409),r.b),f=new URL(r(3232),r.b),h=new URL(r(1265),r.b),p=new URL(r(6267),r.b),d=new URL(r(186),r.b),y=new URL(r(9745),r.b),m=new URL(r(8490),r.b),v=new URL(r(2573),r.b),b=new URL(r(4496),r.b),g=new URL(r(8956),r.b),w=new URL(r(9221),r.b),L=new URL(r(6092),r.b),P=new URL(r(4184),r.b),S=new URL(r(5513),r.b),x=new URL(r(3062),r.b),k=new URL(r(4875),r.b),O=new URL(r(5134),r.b),E=new URL(r(7335),r.b),C=new URL(r(6153),r.b),M=new URL(r(9e3),r.b),j=new URL(r(9593),r.b),_=new URL(r(5523),r.b),T=new URL(r(7986),r.b),R=new URL(r(4041),r.b),G=new URL(r(7538),r.b),U=new URL(r(1605),r.b),$=new URL(r(6318),r.b),A=new URL(r(3933),r.b),N=new URL(r(6291),r.b),I=new URL(r(9702),r.b),B=new URL(r(1906),r.b),z=new URL(r(4347),r.b),D=new URL(r(1216),r.b),F=new URL(r(4437),r.b),q=new URL(r(3160),r.b),H=new URL(r(8341),r.b),Y=new URL(r(2076),r.b),J=new URL(r(3860),r.b),Q=new URL(r(6943),r.b),W=new URL(r(6168),r.b),K=new URL(r(227),r.b),V=new URL(r(756),r.b),X=new URL(r(9334),r.b),Z=i()(o()),tt=l()(s),et=l()(u),rt=l()(f),nt=l()(h),ot=l()(p),at=l()(d),it=l()(y),ct=l()(m),lt=l()(v),st=l()(b),ut=l()(g),ft=l()(w),ht=l()(L),pt=l()(P),dt=l()(S),yt=l()(x),mt=l()(k),vt=l()(O),bt=l()(E),gt=l()(C),wt=l()(M),Lt=l()(j),Pt=l()(_),St=l()(T),xt=l()(R),kt=l()(G),Ot=l()(U),Et=l()($),Ct=l()(A),Mt=l()(N),jt=l()(I),_t=l()(B),Tt=l()(z),Rt=l()(D),Gt=l()(F),Ut=l()(q),$t=l()(H),At=l()(Y),Nt=l()(J),It=l()(Q),Bt=l()(W),zt=l()(K),Dt=l()(V),Ft=l()(X);Z.push([t.id,`:root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url(${tt});\n  --map-tile-top-url: url(${et});\n  --map-tile-top-right-url: url(${rt});\n  --map-tile-bottom-left-url: url(${nt});\n  --map-tile-bottom-url: url(${ot});\n  --map-tile-bottom-right-url: url(${at});\n  --map-tile-left-url: url(${it});\n  --map-tile-right-url: url(${ct});\n  --map-tile-center-url: url(${lt});\n}\n\n.board.desert {\n  --map-tile-top-left-url: url(${st});\n  --map-tile-top-url: url(${ut});\n  --map-tile-top-right-url: url(${ft});\n  --map-tile-bottom-left-url: url(${ht});\n  --map-tile-bottom-url: url(${pt});\n  --map-tile-bottom-right-url: url(${dt});\n  --map-tile-left-url: url(${yt});\n  --map-tile-right-url: url(${mt});\n  --map-tile-center-url: url(${vt});\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url(${bt});\n  --map-tile-top-url: url(${gt});\n  --map-tile-top-right-url: url(${wt});\n  --map-tile-bottom-left-url: url(${Lt});\n  --map-tile-bottom-url: url(${Pt});\n  --map-tile-bottom-right-url: url(${St});\n  --map-tile-left-url: url(${xt});\n  --map-tile-right-url: url(${kt});\n  --map-tile-center-url: url(${Ot});\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url(${Et});\n  --map-tile-top-url: url(${Ct});\n  --map-tile-top-right-url: url(${Mt});\n  --map-tile-bottom-left-url: url(${jt});\n  --map-tile-bottom-url: url(${_t});\n  --map-tile-bottom-right-url: url(${Tt});\n  --map-tile-left-url: url(${Rt});\n  --map-tile-right-url: url(${Gt});\n  --map-tile-center-url: url(${Ut});\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 99;\n}\n\n.character.generic {\n  background: url(${$t});\n}\n\n.character.bowman {\n  background: url(${At});\n}\n\n.character.daemon {\n  background: url(${Nt});\n}\n\n.character.magician {\n  background: url(${It});\n}\n\n.character.swordsman {\n  background: url(${Bt});\n}\n\n.character.undead {\n  background: url(${zt});\n}\n\n.character.vampire {\n  background: url(${Dt});\n}\n\n.character.zombie {\n  background: url(${Ft});\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n.damage {\n  position: absolute;\n  width: var(--cell-size);\n  text-align: center;\n  z-index: 999;\n  color: #f00;\n  font-weight: bold;\n  animation: 500ms fade ease-out;\n}\n\n@keyframes fade {\n  from {\n    opacity: 0;\n    top: calc(var(--cell-size) * 0.5);\n    font-size: 1rem;\n  }\n  to {\n    opacity: 1;\n    top: -20px;\n    font-size: 1.5rem;\n  }\n}\n`,""]);const qt=Z},6314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",n=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),n&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),n&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,n,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var i={};if(n)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(i[l]=!0)}for(var s=0;s<t.length;s++){var u=[].concat(t[s]);n&&i[u[0]]||(void 0!==a&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=a),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),e.push(u))}},e}},4417:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},1601:t=>{t.exports=function(t){return t[1]}},5072:t=>{var e=[];function r(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].identifier===t){r=n;break}return r}function n(t,n){for(var a={},i=[],c=0;c<t.length;c++){var l=t[c],s=n.base?l[0]+n.base:l[0],u=a[s]||0,f="".concat(s," ").concat(u);a[s]=u+1;var h=r(f),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)e[h].references++,e[h].updater(p);else{var d=o(p,n);n.byIndex=c,e.splice(c,0,{identifier:f,updater:d,references:1})}i.push(f)}return i}function o(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,o){var a=n(t=t||[],o=o||{});return function(t){t=t||[];for(var i=0;i<a.length;i++){var c=r(a[i]);e[c].references--}for(var l=n(t,o),s=0;s<a.length;s++){var u=r(a[s]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}a=l}}},7659:t=>{var e={};t.exports=function(t,r){var n=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},5056:(t,e,r)=>{t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},7825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var o=void 0!==r.layer;o&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,o&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var a=r.sourceMap;a&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},1113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},9593:(t,e,r)=>{t.exports=r.p+"b27323cf850ed820855c.png"},7986:(t,e,r)=>{t.exports=r.p+"ac9d74f57639792774bc.png"},5523:(t,e,r)=>{t.exports=r.p+"63aae58e4690953a3857.png"},1605:(t,e,r)=>{t.exports=r.p+"246277b8ca590816b3e8.png"},4041:(t,e,r)=>{t.exports=r.p+"3d9503e0a850fda86f82.png"},7538:(t,e,r)=>{t.exports=r.p+"22e7c5ede3f747cbe27a.png"},7335:(t,e,r)=>{t.exports=r.p+"eab6a2cc5e89a4dd8e3f.png"},9e3:(t,e,r)=>{t.exports=r.p+"d31d84c693f649766aee.png"},6153:(t,e,r)=>{t.exports=r.p+"e0aa3daf6d08c62c96d9.png"},2076:(t,e,r)=>{t.exports=r.p+"cec542854b228e61547a.png"},3860:(t,e,r)=>{t.exports=r.p+"cf170a9fea1051b7424a.png"},8341:(t,e,r)=>{t.exports=r.p+"0a77fc47d727eab6fd39.png"},6943:(t,e,r)=>{t.exports=r.p+"c0fa2b75539f94144dc4.png"},6168:(t,e,r)=>{t.exports=r.p+"2007ec00c1d9f997e704.png"},227:(t,e,r)=>{t.exports=r.p+"f5c75398bcb5931f9f3c.png"},756:(t,e,r)=>{t.exports=r.p+"bf0ed0dca1d1e6091d42.png"},9334:(t,e,r)=>{t.exports=r.p+"296dfeac15e2377fc1dc.png"},6092:(t,e,r)=>{t.exports=r.p+"13edb269e39172ddd74f.png"},5513:(t,e,r)=>{t.exports=r.p+"5cf9c17d6a1ea7106a6c.png"},4184:(t,e,r)=>{t.exports=r.p+"f1703771380a9959d979.png"},5134:(t,e,r)=>{t.exports=r.p+"51e2a5de56bd631452fe.png"},3062:(t,e,r)=>{t.exports=r.p+"eb1f6e4f87b977012684.png"},4875:(t,e,r)=>{t.exports=r.p+"2c19971f327b288278bb.png"},4496:(t,e,r)=>{t.exports=r.p+"258d884122fabfc2f312.png"},9221:(t,e,r)=>{t.exports=r.p+"2f1e1970c2c20cf3a8d5.png"},8956:(t,e,r)=>{t.exports=r.p+"dc3f97e7bbcd5ea1ded9.png"},9702:(t,e,r)=>{t.exports=r.p+"1d70f1dab2dd418c3612.png"},4347:(t,e,r)=>{t.exports=r.p+"6bacb8e25ed9ecf726bf.png"},1906:(t,e,r)=>{t.exports=r.p+"f462d2ed6eedca1e4fd9.png"},3160:(t,e,r)=>{t.exports=r.p+"6f6f7c09bde970b2e41b.png"},1216:(t,e,r)=>{t.exports=r.p+"c75f062dddba6e98fdc6.png"},4437:(t,e,r)=>{t.exports=r.p+"26fdc25019c24e87f11a.png"},6318:(t,e,r)=>{t.exports=r.p+"ef1b0ea8c4e545d9aadc.png"},6291:(t,e,r)=>{t.exports=r.p+"a1d2321024649b9d8f5f.png"},3933:(t,e,r)=>{t.exports=r.p+"8b928c3eb136543e573a.png"},1265:(t,e,r)=>{t.exports=r.p+"26b5f224d8750119922d.png"},186:(t,e,r)=>{t.exports=r.p+"2429af6d3a5796e3c34b.png"},6267:(t,e,r)=>{t.exports=r.p+"07d5e8127645225478b6.png"},2573:(t,e,r)=>{t.exports=r.p+"0089a610e6611f679b50.png"},9745:(t,e,r)=>{t.exports=r.p+"546abb060a0837550fd1.png"},8490:(t,e,r)=>{t.exports=r.p+"6a84ae91f5d985ddc9ee.png"},7935:(t,e,r)=>{t.exports=r.p+"46d63299c3420c030b4e.png"},3232:(t,e,r)=>{t.exports=r.p+"0ac7f8258ec7166dc957.png"},1409:(t,e,r)=>{t.exports=r.p+"946aeb948db6313f1d85.png"}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={id:n,exports:{}};return t[n](a,a.exports,r),a.exports}r.m=t,r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=n[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),r.b=document.baseURI||self.location.href,r.nc=void 0;var n=r(5072),o=r.n(n),a=r(7825),i=r.n(a),c=r(7659),l=r.n(c),s=r(5056),u=r.n(s),f=r(540),h=r.n(f),p=r(1113),d=r.n(p),y=r(1016),m={};function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function g(t,e){if(t){if("string"==typeof t)return w(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,P(n.key),n)}}function P(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}m.styleTagTransform=d(),m.setAttributes=u(),m.insert=l().bind(null,"head"),m.domAPI=i(),m.insertStyleElement=h(),o()(y.A,m),y.A&&y.A.locals&&y.A.locals;var S=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]},e=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(t){var e,r,n=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(t){return n.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return n.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return n.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var o=0;o<Math.pow(this.boardSize,2);o+=1){var a=document.createElement("div");a.classList.add("cell","map-tile","map-tile-".concat((e=o,r=this.boardSize,0===e?"top-left":e==r-1?"top-right":e===r*r-1?"bottom-right":e===r*(r-1)?"bottom-left":e%8==0?"left":e%8==7?"right":e>0&&e<8?"top":e>r*(r-1)&&e<r*r-1?"bottom":"center"))),a.addEventListener("mouseenter",(function(t){return n.onCellEnter(t)})),a.addEventListener("mouseleave",(function(t){return n.onCellLeave(t)})),a.addEventListener("click",(function(t){return n.onCellClick(t)})),this.boardEl.appendChild(a)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var e,r=b(this.cells);try{for(r.s();!(e=r.n()).done;)e.value.innerHTML=""}catch(t){r.e(t)}finally{r.f()}var n,o,a=b(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,c=this.boardEl.children[i.position],l=document.createElement("div");l.classList.add("character",i.character.type);var s=document.createElement("div");s.classList.add("health-level");var u=document.createElement("div");u.classList.add("health-level-indicator","health-level-indicator-".concat((o=i.character.health)<15?"critical":o<50?"normal":"high")),u.style.width="".concat(i.character.health,"%"),s.appendChild(u),l.appendChild(s),c.appendChild(l)}}catch(t){a.e(t)}finally{a.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var e,r=this.cells[t];(e=r.classList).remove.apply(e,function(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(r.classList).filter((function(t){return t.startsWith("selected")}))))}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var o=r.cells[t],a=document.createElement("span");a.textContent=e,a.classList.add("damage"),o.appendChild(a),a.addEventListener("animationend",(function(){o.removeChild(a),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],r=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],e&&L(t.prototype,e),r&&L(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();const x={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"},k="auto",O="pointer",E="crosshair",C="not-allowed";function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function j(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,T(n.key),n)}}function _(t,e,r){return e&&j(t.prototype,e),r&&j(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function T(t){var e=function(t,e){if("object"!=M(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==M(e)?e:e+""}var R=_((function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"Character"===(this instanceof t?this.constructor:void 0).name)throw new Error("Нельзя создать персонажа неопределенного типа!");this.level=e,this.attack=0,this.defence=0,this.level>1?this.health=100:this.health=50,this.type=r}));function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function U(t,e,r){return e=A(e),function(t,e){if(e&&("object"==G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,$()?Reflect.construct(e,r||[],A(t).constructor):e.apply(t,r))}function $(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return($=function(){return!!t})()}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}function N(t,e){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},N(t,e)}var I=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bowman";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=U(this,e,[t,n])).attack=25*Math.pow(1.3,r.level-1),r.defence=25*Math.pow(1.3,r.level-1),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(R);function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function z(t,e,r){return e=F(e),function(t,e){if(e&&("object"==B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,D()?Reflect.construct(e,r||[],F(t).constructor):e.apply(t,r))}function D(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(D=function(){return!!t})()}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},F(t)}function q(t,e){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},q(t,e)}var H=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"daemon";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=z(this,e,[t,n])).attack=10*Math.pow(1.3,r.level-1),r.defence=10*Math.pow(1.3,r.level-1),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&q(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(R);function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function J(t,e,r){return e=W(e),function(t,e){if(e&&("object"==Y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Q()?Reflect.construct(e,r||[],W(t).constructor):e.apply(t,r))}function Q(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Q=function(){return!!t})()}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},W(t)}function K(t,e){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K(t,e)}var V=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"swordsman";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=J(this,e,[t,n])).attack=40*Math.pow(1.3,r.level-1),r.defence=10*Math.pow(1.3,r.level-1),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(R);function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}function Z(t,e,r){return e=et(e),function(t,e){if(e&&("object"==X(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,tt()?Reflect.construct(e,r||[],et(t).constructor):e.apply(t,r))}function tt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tt=function(){return!!t})()}function et(t){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},et(t)}function rt(t,e){return rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rt(t,e)}var nt=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"magician";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Z(this,e,[t,n])).attack=10*Math.pow(1.3,r.level-1),r.defence=40*Math.pow(1.3,r.level-1),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rt(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(R);function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function at(t,e,r){return e=ct(e),function(t,e){if(e&&("object"==ot(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,it()?Reflect.construct(e,r||[],ct(t).constructor):e.apply(t,r))}function it(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(it=function(){return!!t})()}function ct(t){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ct(t)}function lt(t,e){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lt(t,e)}var st=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"undead";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=at(this,e,[t,n])).attack=40*Math.pow(1.3,r.level-1),r.defence=10*Math.pow(1.3,r.level-1),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lt(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(R);function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function ft(t,e,r){return e=pt(e),function(t,e){if(e&&("object"==ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ht()?Reflect.construct(e,r||[],pt(t).constructor):e.apply(t,r))}function ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ht=function(){return!!t})()}function pt(t){return pt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pt(t)}function dt(t,e){return dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dt(t,e)}var yt=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vampire";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=ft(this,e,[t,n])).attack=25*Math.pow(1.3,r.level-1),r.defence=25*Math.pow(1.3,r.level-1),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dt(t,e)}(e,t),r=e,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(R);function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,gt(n.key),n)}}function bt(t,e,r){return e&&vt(t.prototype,e),r&&vt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function gt(t){var e=function(t,e){if("object"!=mt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mt(e)?e:e+""}var wt=bt((function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof R))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=e,this.position=r}));function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xt(n.key),n)}}function St(t,e,r){return e&&Pt(t.prototype,e),r&&Pt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function xt(t){var e=function(t,e){if("object"!=Lt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lt(e)?e:e+""}var kt=St((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.characters=e}));function Ot(t){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(t)}function Et(){Et=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof v?e:v,i=Object.create(a.prototype),c=new j(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function b(){}function g(){}var w={};s(w,i,(function(){return this}));var L=Object.getPrototypeOf,P=L&&L(L(_([])));P&&P!==r&&n.call(P,i)&&(w=P);var S=g.prototype=v.prototype=Object.create(w);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,c){var l=f(t[o],t,a);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==Ot(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(u).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var l=E(c,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function E(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,m;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Ot(e)+" is not iterable")}return b.prototype=g,o(S,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=s(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},x(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},x(S),s(S,l,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}var Ct=Et().mark(Mt);function Mt(t,e){return Et().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,new(t[Math.floor(Math.random()*t.length)])(e);case 2:case"end":return r.stop()}}),Ct)}function jt(t,e,r){for(var n=[],o=0;o<r;o++)n.push(Mt(t,e).next().value);return new kt(n)}function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function Tt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rt(n.key),n)}}function Rt(t){var e=function(t,e){if("object"!=_t(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=_t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_t(e)?e:e+""}var Gt=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.turn=e,this.positions=r,this.theme=n}return e=t,r=[{key:"from",value:function(e){return e?new t(e.turn,e.positions,e.theme):null}}],null&&Tt(e.prototype,null),r&&Tt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r}();function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function $t(){$t=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof v?e:v,i=Object.create(a.prototype),c=new j(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function b(){}function g(){}var w={};s(w,i,(function(){return this}));var L=Object.getPrototypeOf,P=L&&L(L(_([])));P&&P!==r&&n.call(P,i)&&(w=P);var S=g.prototype=v.prototype=Object.create(w);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,c){var l=f(t[o],t,a);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==Ut(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(u).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var l=E(c,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function E(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,m;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(Ut(e)+" is not iterable")}return b.prototype=g,o(S,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=s(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},x(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},x(S),s(S,l,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function At(t){return function(t){if(Array.isArray(t))return Dt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||zt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(t,e,r,n,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void r(t)}c.done?e(l):Promise.resolve(l).then(n,o)}function It(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){Nt(a,n,o,i,c,"next",t)}function c(t){Nt(a,n,o,i,c,"throw",t)}i(void 0)}))}}function Bt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=zt(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function zt(t,e){if(t){if("string"==typeof t)return Dt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dt(t,e):void 0}}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Ft(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,qt(n.key),n)}}function qt(t){var e=function(t,e){if("object"!=Ut(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ut(e)?e:e+""}var Ht=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gamePlay=e,this.stateService=r,this.positions=[],this.theme=x.prairie,this.points=0,this.turn},(e=[{key:"init",value:function(){var t=[I,V,nt],e=[H,st,yt];this.theme=x.prairie,this.turn="user",this.gamePlay.drawUi(this.theme);var r=jt(t,2,2),n=jt(e,2,2),o=[];this.positions=[];for(var a=0;a<r.characters.length;a++){var i=void 0;do{i=Math.floor(64*Math.random())}while(i%8!=0&&i%8!=1||-1!==o.indexOf(i));o.push(i)}for(var c=0;c<o.length;c++)this.positions.push(new wt(r.characters[c],o[c]));o=[];for(var l=0;l<n.characters.length;l++){var s=void 0;do{s=Math.floor(64*Math.random())}while(s%8!=6&&s%8!=7||-1!==o.indexOf(s));o.push(s)}for(var u=0;u<o.length;u++)this.positions.push(new wt(n.characters[u],o[u]));this.gamePlay.redrawPositions(this.positions),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGame.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGame.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGame.bind(this))}},{key:"onCellClick",value:function(t){var e=this,r=[H,st,yt];if("user"===this.turn&&(this.gamePlay.cells[t].firstChild&&(this.gamePlay.cells[t].firstChild.classList.contains("bowman")||this.gamePlay.cells[t].firstChild.classList.contains("swordsman")||this.gamePlay.cells[t].firstChild.classList.contains("magician"))&&(this.clearSelected(),this.gamePlay.selectCell(t)),this.returnSelectedCharacter())){if(this.gamePlay.cells[t].classList.contains("selected-green")&&!this.gamePlay.cells[t].firstChild){var n,o=this.gamePlay.cells.indexOf(this.returnSelectedCharacter()),a=Bt(this.positions);try{for(a.s();!(n=a.n()).done;){var i=n.value;i.position===o&&(i.position=t)}}catch(t){a.e(t)}finally{a.f()}this.gamePlay.redrawPositions(this.positions),this.gamePlay.selectCell(t),this.gamePlay.deselectCell(o),this.turn="enemy"}this.gamePlay.cells[t].classList.contains("selected-red")?It($t().mark((function n(){var o,a,i,c,l,s,u,f,h,p,d,y,m,v,b,g,w,L,P,S;return $t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e.gamePlay.cells.indexOf(e.returnSelectedCharacter()),c=Bt(e.positions);try{for(c.s();!(l=c.n()).done;)(s=l.value).position===o&&(a=s),s.position===t&&(i=s)}catch(t){c.e(t)}finally{c.f()}return u=Math.max(a.character.attack-i.character.defence,.1*a.character.attack),i.character.health-=u,n.next=7,e.gamePlay.showDamage(t,Math.max(a.character.attack-i.character.defence,.1*a.character.attack));case 7:if(i.character.health<=0){if(e.positions=e.positions.filter((function(t){return t!==i})),!e.isEnemyTeamAlive()){f=Bt(e.positions);try{for(f.s();!(h=f.n()).done;)(p=h.value).character.attack=Math.max(p.character.attack,p.character.attack*(80+p.character.health)/100),p.character.defence=Math.max(p.character.defence,p.character.defence*(80+p.character.health)/100),p.character.health+=80,p.character.health>100&&(p.character.health=100),p.character.level+=1}catch(t){f.e(t)}finally{f.f()}for(e.points+=1,d=Object.keys(x),y=d.indexOf(e.theme),e.theme=x[d[(y+1)%4]],e.gamePlay.drawUi(e.theme),m=jt(r,2,2),v=[],b=0;b<m.characters.length;b++){g=void 0;do{g=Math.floor(64*Math.random())}while(g%8!=6&&g%8!=7||-1!==v.indexOf(g)||e.gamePlay.cells[g].firstChild);v.push(g)}for(w=[],L=0;L<v.length;L++)w.push(new wt(m.characters[L],v[L]));e.positions=[].concat(At(e.positions),w),e.gamePlay.redrawPositions(e.positions)}}else{P=Bt(e.positions);try{for(P.s();!(S=P.n()).done;)S.value.position,i.position}catch(t){P.e(t)}finally{P.f()}}e.gamePlay.redrawPositions(e.positions),e.turn="enemy";case 10:case"end":return n.stop()}}),n)})))():this.gamePlay.cells[t].firstChild?!this.returnSelectedCharacter()&&this.gamePlay.cells[t].firstChild&&["daemon","undead","vampire"].some((function(r){return e.gamePlay.cells[t].firstChild&&e.gamePlay.cells[t].firstChild.classList.contains(r)}))&&S.showError("Вы пытаетесь выбрать вражеского персонажа"):S.showError("Вы пытаетесь выбрать пустую клетку")}if("enemy"===this.turn){var c,l=[],s=[],u=Bt(this.positions);try{for(u.s();!(c=u.n()).done;){var f=c.value;["bowman","swordsman","magician"].includes(f.character.type)?l.push(f):s.push(f)}}catch(t){u.e(t)}finally{u.f()}for(var h,p,d=0,y=1/0,m=0,v=s;m<v.length;m++){var b=v[m];b.character.attack>d&&(d=b.character.attack,h=b)}for(var g=0,w=l;g<w.length;g++){var L=w[g];L.character.defence<y&&(y=L.character.defence,p=L)}if("daemon"===h.character.type)if(this.canMagicianAttack(h.position,p.position))It($t().mark((function t(){var r,n,o;return $t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Math.max(h.character.attack-p.character.defence,.1*h.character.attack),t.next=3,e.gamePlay.showDamage(p.position,r);case 3:if(p.character.health-=r,p.character.health<0)e.positions=e.positions.filter((function(t){return t!==p}));else{n=Bt(e.positions);try{for(n.s();!(o=n.n()).done;)o.value.position,p.position}catch(t){n.e(t)}finally{n.f()}}e.gamePlay.redrawPositions(e.positions),e.turn="user";case 7:case"end":return t.stop()}}),t)})))();else{for(var P=[],k=0;k<63;k++)this.canMagicianMove(h.position,k)&&!this.gamePlay.cells[k].firstChild&&P.push(k);for(var O=P[0],E=Math.abs(O%8-h.position%8),C=Math.abs(Math.floor(O/8)-Math.floor(h.position/8)),M=Math.sqrt(E*E+C*C),j=0,_=P;j<_.length;j++){var T=_[j],R=Math.abs(T%8-h.position%8),G=Math.abs(Math.floor(T/8)-Math.floor(h.position/8)),U=Math.sqrt(R*R+G*G);U<M&&(M=U,O=T)}var $,A=Bt(this.positions);try{for(A.s();!($=A.n()).done;){var N=$.value;N.position===h.position&&(N.position=O)}}catch(t){A.e(t)}finally{A.f()}this.gamePlay.redrawPositions(this.positions),this.turn="user"}if("vampire"===h.character.type)if(this.canBowmanAttack(h.position,p.position))It($t().mark((function t(){var r,n,o;return $t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Math.max(h.character.attack-p.character.defence,.1*h.character.attack),t.next=3,e.gamePlay.showDamage(p.position,r);case 3:if(p.character.health-=r,p.character.health<0)e.positions=e.positions.filter((function(t){return t!==p}));else{n=Bt(e.positions);try{for(n.s();!(o=n.n()).done;)o.value.position,p.position}catch(t){n.e(t)}finally{n.f()}}e.gamePlay.redrawPositions(e.positions),e.turn="user";case 7:case"end":return t.stop()}}),t)})))();else{for(var I=[],B=0;B<63;B++)this.canMagicianMove(h.position,B)&&!this.gamePlay.cells[B].firstChild&&I.push(B);for(var z=I[0],D=Math.abs(z%8-h.position%8),F=Math.abs(Math.floor(z/8)-Math.floor(h.position/8)),q=Math.sqrt(D*D+F*F),Y=0,J=I;Y<J.length;Y++){var Q=J[Y],W=Math.abs(Q%8-h.position%8),K=Math.abs(Math.floor(Q/8)-Math.floor(h.position/8)),V=Math.sqrt(W*W+K*K);V<q&&(q=V,z=Q)}var X,Z=Bt(this.positions);try{for(Z.s();!(X=Z.n()).done;){var tt=X.value;tt.position===h.position&&(tt.position=z)}}catch(t){Z.e(t)}finally{Z.f()}this.gamePlay.redrawPositions(this.positions),this.turn="user"}if("undead"===h.character.type)if(this.canSwordsmanAttack(h.position,p.position))It($t().mark((function t(){var r,n,o;return $t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Math.max(h.character.attack-p.character.defence,.1*h.character.attack),t.next=3,e.gamePlay.showDamage(p.position,r);case 3:if(p.character.health-=r,p.character.health<0)e.positions=e.positions.filter((function(t){return t!==p}));else{n=Bt(e.positions);try{for(n.s();!(o=n.n()).done;)o.value.position,p.position}catch(t){n.e(t)}finally{n.f()}}e.gamePlay.redrawPositions(e.positions),e.turn="user";case 7:case"end":return t.stop()}}),t)})))();else{for(var et=[],rt=0;rt<63;rt++)this.canMagicianMove(h.position,rt)&&!this.gamePlay.cells[rt].firstChild&&et.push(rt);for(var nt=et[0],ot=Math.abs(nt%8-h.position%8),at=Math.abs(Math.floor(nt/8)-Math.floor(h.position/8)),it=Math.sqrt(ot*ot+at*at),ct=0,lt=et;ct<lt.length;ct++){var ut=lt[ct],ft=Math.abs(ut%8-h.position%8),ht=Math.abs(Math.floor(ut/8)-Math.floor(h.position/8)),pt=Math.sqrt(ft*ft+ht*ht);pt<it&&(it=pt,nt=ut)}var dt,mt=Bt(this.positions);try{for(mt.s();!(dt=mt.n()).done;){var vt=dt.value;vt.position===h.position&&(vt.position=nt)}}catch(t){mt.e(t)}finally{mt.f()}this.gamePlay.redrawPositions(this.positions),this.turn="user"}}if(!this.isFriendTeamAlive()||!this.isEnemyTeamAlive()&&this.theme===x.mountain)return!1}},{key:"onCellEnter",value:function(t){var e,r,n,o=Bt(this.positions);try{for(o.s();!(r=o.n()).done;){var a=r.value;a.position===t&&(e=a.character)}}catch(t){o.e(t)}finally{o.f()}e&&this.gamePlay.showCellTooltip("🎖 ".concat((n=e).level," ⚔ ").concat(n.attack," 🛡 ").concat(n.defence," ❤ ").concat(n.health),t),this.returnSelectedCharacter()&&(this.gamePlay.setCursor(C),this.gamePlay.cells[t].firstChild&&(this.gamePlay.cells[t].firstChild.classList.contains("bowman")||this.gamePlay.cells[t].firstChild.classList.contains("swordsman")||this.gamePlay.cells[t].firstChild.classList.contains("magician"))?this.gamePlay.setCursor(O):this.returnSelectedCharacter().firstChild&&this.returnSelectedCharacter().firstChild.classList.contains("bowman")?(this.canBowmanMove(this.gamePlay.cells.indexOf(this.returnSelectedCharacter()),t)&&this.gamePlay.selectCell(t,"green"),this.canBowmanAttack(this.gamePlay.cells.indexOf(this.returnSelectedCharacter()),t)&&this.gamePlay.cells[t].firstChild&&(this.gamePlay.cells[t].firstChild.classList.contains("daemon")||this.gamePlay.cells[t].firstChild.classList.contains("undead")||this.gamePlay.cells[t].firstChild.classList.contains("vampire"))&&this.gamePlay.selectCell(t,"red")):this.returnSelectedCharacter().firstChild&&this.returnSelectedCharacter().firstChild.classList.contains("swordsman")?(this.canSwordsmanMove(this.gamePlay.cells.indexOf(this.returnSelectedCharacter()),t)&&this.gamePlay.selectCell(t,"green"),this.canSwordsmanAttack(this.gamePlay.cells.indexOf(this.returnSelectedCharacter()),t)&&this.gamePlay.cells[t].firstChild&&(this.gamePlay.cells[t].firstChild&&this.gamePlay.cells[t].firstChild.classList.contains("daemon")||this.gamePlay.cells[t].firstChild.classList.contains("undead")||this.gamePlay.cells[t].firstChild.classList.contains("vampire"))&&this.gamePlay.selectCell(t,"red")):this.returnSelectedCharacter().firstChild&&this.returnSelectedCharacter().firstChild.classList.contains("magician")&&(this.canMagicianMove(this.gamePlay.cells.indexOf(this.returnSelectedCharacter()),t)&&this.gamePlay.selectCell(t,"green"),this.canMagicianAttack(this.gamePlay.cells.indexOf(this.returnSelectedCharacter()),t)&&this.gamePlay.cells[t].firstChild&&(this.gamePlay.cells[t].firstChild.classList.contains("daemon")||this.gamePlay.cells[t].firstChild.classList.contains("undead")||this.gamePlay.cells[t].firstChild.classList.contains("vampire"))&&this.gamePlay.selectCell(t,"red"))),this.gamePlay.cells[t].classList.contains("selected-green")&&this.gamePlay.setCursor(O),this.gamePlay.cells[t].classList.contains("selected-red")&&this.gamePlay.setCursor(E)}},{key:"onCellLeave",value:function(t){var e=this;this.gamePlay.hideCellTooltip(t),this.gamePlay.cells[t].classList.contains("selected")&&!["bowman","swordsman","magician"].some((function(r){return e.gamePlay.cells[t].firstChild&&e.gamePlay.cells[t].firstChild.classList.contains(r)}))&&(this.gamePlay.deselectCell(t),this.gamePlay.setCursor(k))}},{key:"clearSelected",value:function(){var t,e=Bt(this.gamePlay.cells.filter((function(t){return t.classList.contains("selected")})));try{for(e.s();!(t=e.n()).done;){var r=t.value;this.gamePlay.deselectCell(this.gamePlay.cells.indexOf(r))}}catch(t){e.e(t)}finally{e.f()}}},{key:"returnSelectedCharacter",value:function(){var t=this.gamePlay.cells.filter((function(t){return t.classList.contains("selected-yellow")&&t.firstChild&&t.firstChild.classList.contains("character")}));if(t)return t[0]}},{key:"canSwordsmanMove",value:function(t,e){return!(e<0||t>63)&&(!!this.canBowmanMove(t,e)||Math.abs(t%8-e%8)<=4&&0===Math.abs(Math.floor(t/8)-Math.floor(e/8))||0===Math.abs(t%8-e%8)&&Math.abs(Math.floor(t/8)-Math.floor(e/8))<=4||Math.abs(t%8-e%8)===Math.abs(Math.floor(t/8)-Math.floor(e/8))&&Math.abs(t%8-e%8)<=4)}},{key:"canBowmanMove",value:function(t,e){return!(e<0||t>63)&&(!!this.canMagicianMove(t,e)||2===Math.abs(t%8-e%8)&&0===Math.abs(Math.floor(t/8)-Math.floor(e/8))||0===Math.abs(t%8-e%8)&&2===Math.abs(Math.floor(t/8)-Math.floor(e/8))||Math.abs(t%8-e%8)===Math.abs(Math.floor(t/8)-Math.floor(e/8))&&2===Math.abs(t%8-e%8))}},{key:"canMagicianMove",value:function(t,e){return!(e<0||t>63)&&(Math.abs(t%8-e%8)<2&&Math.abs(Math.floor(t/8)-Math.floor(e/8))<2||!(Math.abs(t%8-e%8)!==Math.abs(Math.floor(t/8)-Math.floor(e/8))||1!==Math.abs(t%8-e%8)||!Math.abs(Math.floor(t/8)-Math.floor(e/8))))}},{key:"canSwordsmanAttack",value:function(t,e){return this.canMagicianMove(t,e)}},{key:"canBowmanAttack",value:function(t,e){return this.canBowmanMove(t,e)}},{key:"canMagicianAttack",value:function(t,e){return this.canSwordsmanMove(t,e)}},{key:"isEnemyTeamAlive",value:function(){var t,e=Bt(this.positions);try{for(e.s();!(t=e.n()).done;){var r=t.value;if(["vampire","undead","daemon"].includes(r.character.type))return!0}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isFriendTeamAlive",value:function(){var t,e=Bt(this.positions);try{for(e.s();!(t=e.n()).done;){var r=t.value;if(["bowman","swordsman","magician"].includes(r.character.type))return!0}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"onNewGame",value:function(){this.init()}},{key:"onSaveGame",value:function(){var t=Gt.from({turn:this.turn,positions:this.positions,theme:this.theme});this.stateService.save(t)}},{key:"onLoadGame",value:function(){this.stateService.load()&&(this.gamePlay.drawUi(state.theme),this.gamePlay.redrawPositions(state.positions),this.turn=state.turn)}}])&&Ft(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Yt(t){return Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt(t)}function Jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qt(n.key),n)}}function Qt(t){var e=function(t,e){if("object"!=Yt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Yt(e)?e:e+""}var Wt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e},e=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{if(!this.storage.getItem("state"))throw new Error("Invalid state");return JSON.parse(this.storage.getItem("state"))}catch(t){S.showMessage(t.message)}}}],e&&Jt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),Kt=new S;Kt.bindToDOM(document.querySelector("#game-container")),localStorage.clear(),new Ht(Kt,new Wt(localStorage)).init()})();